<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>Kertas Kerja Rasmi Premium</title>
    <style>
        /* FONT IMPORT - Menggunakan font yang nampak mahal dan rasmi */
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Inter:wght@400;600&display=swap');

        :root {
            --paper-width: 210mm;
            --paper-height: 297mm;
            --accent-color: #1a365d; /* Blue Navy Rasmi */
        }

        body { 
            background: #e2e8f0; 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 50px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* EDITOR FLOATING PANEL */
        .no-print {
            width: 800px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid #fff;
        }

        .section-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--accent-color);
            margin: 25px 0 15px 0;
            padding-bottom: 5px;
        }

        /* KERTAS A4 PREMIUM */
        #preview {
            width: var(--paper-width);
            min-height: var(--paper-height);
            background: white;
            padding: 30mm 25mm; /* Margin Standard Dokumen Rasmi */
            box-sizing: border-box;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            font-family: 'Crimson Pro', serif; /* Font nampak macam surat rasmi */
            color: #1a202c;
            line-height: 1.5;
        }

        /* TYPOGRAPHY DOKUMEN */
        #v-tajuk {
            text-align: center;
            font-size: 22px;
            font-weight: 700;
            text-transform: uppercase;
            border-bottom: 3px double #000;
            padding-bottom: 10px;
            margin-bottom: 40px;
            color: #000;
        }

        h4 {
            font-size: 16px;
            font-weight: 700;
            margin: 25px 0 10px 0;
            color: #000;
        }

        p { font-size: 14px; margin: 0; text-align: justify; }

        /* TABLE STYLE - CLEAN & MINIMALIST */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            border: 1px solid #cbd5e1;
            padding: 10px 12px;
            font-size: 14px;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
        }

        .col-bil { width: 30px; text-align: center; }

        .borderless td {
            border: none;
            padding: 4px 0;
            font-weight: 600;
        }

        /* SIGNATURE SECTION */
        .sig-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-top: 60px;
        }

        .sig-box { text-align: center; font-size: 13px; }
        .sig-line { 
            border-bottom: 1px solid #000; 
            margin-bottom: 10px; 
            height: 70px; 
        }

        /* INPUT STYLE IN EDITOR */
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            margin-top: 5px;
            font-family: 'Inter', sans-serif;
        }

        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: 0.3s;
        }

        .btn-main { background: var(--accent-color); color: white; }
        .btn-save { background: #10b981; color: white; }

        @media print {
            body { background: white; padding: 0; }
            .no-print { display: none; }
            #preview { box-shadow: none; margin: 0; width: 100%; padding: 20mm 15mm; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3 style="margin:0; font-family:'Inter'">Smart Proposal Editor</h3>
        <div>
            <button class="btn btn-save" onclick="exportJSON()">ðŸ’¾ Simpan Kerja</button>
            <button class="btn" style="background:#f1f5f9" onclick="document.getElementById('importFile').click()">ðŸ“‚ Buka Projek</button>
            <input type="file" id="importFile" style="display:none" onchange="importJSON(event)">
        </div>
    </div>

    <div class="section-title">A. Maklumat Utama</div>
    <label>Tajuk Kertas Kerja:</label>
    <input type="text" id="in-tajuk" oninput="kemaskini()" placeholder="Taip tajuk penuh...">
    
    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
        <div><label>Tarikh:</label><input type="text" id="in-tarikh" oninput="kemaskini()"></div>
        <div><label>Masa:</label><input type="text" id="in-masa" oninput="kemaskini()"></div>
        <div><label>Tempat:</label><input type="text" id="in-tempat" oninput="kemaskini()"></div>
    </div>

    <label>1.0 Pendahuluan:</label>
    <textarea id="in-pend" oninput="kemaskini()" rows="3"></textarea>
    
    <label>2.0 Objektif:</label>
    <textarea id="in-obj" oninput="kemaskini()" rows="3"></textarea>

    <div class="section-title">B. Aturcara & Pelaksana</div>
    <div id="inputs-tentatif"></div>
    <button class="btn btn-main" style="font-size: 11px; padding: 5px 10px;" onclick="tambah('tentatif')">+ Tambah Tentatif</button>

    <div id="inputs-ajk" style="margin-top:20px;"></div>
    <button class="btn btn-main" style="font-size: 11px; padding: 5px 10px;" onclick="tambah('ajk')">+ Tambah AJK</button>

    <div class="section-title">C. Perincian Kewangan</div>
    <label>Sumber Dana:</label>
    <div id="inputs-sumber"></div>
    <button class="btn btn-main" style="font-size: 11px; padding: 5px 10px;" onclick="tambah('sumber')">+ Tambah Sumber</button>

    <label>Anggaran Perbelanjaan:</label>
    <div id="inputs-belanja"></div>
    <button class="btn btn-main" style="font-size: 11px; padding: 5px 10px;" onclick="tambah('belanja')">+ Tambah Perbelanjaan</button>

    <div class="section-title">D. Pegawai Bertanggungjawab</div>
    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
        <input type="text" id="s1-n" oninput="kemaskini()" placeholder="Nama Penyedia">
        <input type="text" id="s2-n" oninput="kemaskini()" placeholder="Nama Penyemak">
        <input type="text" id="s3-n" oninput="kemaskini()" placeholder="Nama Pelulus">
        <input type="text" id="s1-j" oninput="kemaskini()" placeholder="Jawatan">
        <input type="text" id="s2-j" oninput="kemaskini()" placeholder="Jawatan">
        <input type="text" id="s3-j" oninput="kemaskini()" placeholder="Jawatan">
    </div>

    <button class="btn btn-main" style="width:100%; margin-top:30px; height:50px; font-size:16px;" onclick="window.print()">ðŸ“¥ CETAK DOKUMEN RASMI (PDF)</button>
</div>

<div id="preview">
    <div id="v-tajuk">KERTAS KERJA CADANGAN PROGRAM</div>

    <h4>1.0 PENDAHULUAN</h4>
    <p id="v-pend">-</p>

    <h4>2.0 OBJEKTIF</h4>
    <p id="v-obj">-</p>

    <h4>3.0 BUTIRAN PROGRAM</h4>
    <table class="borderless" style="width:auto">
        <tr><td width="100">TARIKH</td><td>: <span id="v-tarikh">-</span></td></tr>
        <tr><td>MASA</td><td>: <span id="v-masa">-</span></td></tr>
        <tr><td>TEMPAT</td><td>: <span id="v-tempat">-</span></td></tr>
    </table>

    <h4>4.0 TENTATIF PROGRAM</h4>
    <table>
        <thead><tr><th width="120">MASA</th><th>AKTIVITI</th></tr></thead>
        <tbody id="v-tentatif"></tbody>
    </table>

    <h4>5.0 JAWATANKUASA PELAKSANA</h4>
    <table>
        <thead><tr><th width="200">JAWATAN</th><th>NAMA PEGAWAI</th></tr></thead>
        <tbody id="v-ajk"></tbody>
    </table>

    <h4>6.0 IMPLIKASI KEWANGAN</h4>
    <p style="font-weight:700; margin-bottom:5px">6.1 SUMBER KEWANGAN</p>
    <table>
        <thead><tr><th class="col-bil">BIL</th><th>PERINCIAN</th><th width="120">JUMLAH (RM)</th></tr></thead>
        <tbody id="v-sumber"></tbody>
    </table>

    <p style="font-weight:700; margin:15px 0 5px 0">6.2 ANGGARAN PERBELANJAAN</p>
    <table>
        <thead><tr><th class="col-bil">BIL</th><th>ITEM PERBELANJAAN</th><th width="120">KOS (RM)</th></tr></thead>
        <tbody id="v-belanja"></tbody>
    </table>

    <div class="sig-container">
        <div class="sig-box">Disediakan oleh:<div class="sig-line"></div><strong id="v-s1n"></strong><br><span id="v-s1j"></span></div>
        <div class="sig-box">Disemak oleh:<div class="sig-line"></div><strong id="v-s2n"></strong><br><span id="v-s2j"></span></div>
        <div class="sig-box">Diluluskan oleh:<div class="sig-line"></div><strong id="v-s3n"></strong><br><span id="v-s3j"></span></div>
    </div>
</div>

<script>
// Fungsi penambahan baris kekal dinamik
function tambah(jenis, v1='', v2='') {
    const container = document.getElementById('inputs-' + jenis);
    const div = document.createElement('div');
    div.className = 'input-row';
    
    if(jenis === 'tentatif' || jenis === 'ajk') {
        div.innerHTML = `<input type="text" style="flex:1" placeholder="Masa/Jawatan" value="${v1}" oninput="kemaskini()"><input type="text" style="flex:2" placeholder="Aktiviti/Nama" value="${v2}" oninput="kemaskini()">`;
    } else {
        div.innerHTML = `<input type="text" style="flex:2" placeholder="Perincian" value="${v1}" oninput="kemaskini()"><input type="text" style="flex:1" placeholder="RM" value="${v2}" oninput="kemaskini()">`;
    }
    div.innerHTML += `<button onclick="this.parentElement.remove();kemaskini()" style="background:#fee2e2; border:none; color:red; cursor:pointer;">&times;</button>`;
    container.appendChild(div);
}

function kemaskini() {
    const fields = ['tajuk','tarikh','masa','tempat','pend','obj'];
    fields.forEach(f => {
        document.getElementById('v-'+f).innerText = document.getElementById('in-'+f).value || "-";
    });

    const sigs = [['s1-n','v-s1n','s1-j','v-s1j'],['s2-n','v-s2n','s2-j','v-s2j'],['s3-n','v-s3n','s3-j','v-s3j']];
    sigs.forEach(s => {
        document.getElementById(s[1]).innerText = document.getElementById(s[0]).value.toUpperCase();
        document.getElementById(s[3]).innerText = document.getElementById(s[2]).value;
    });

    // Tables logic
    const fillTable = (inputParent, targetId, isFinance = false) => {
        const rows = document.querySelectorAll(`#${inputParent} .input-row`);
        const target = document.getElementById(targetId);
        target.innerHTML = '';
        rows.forEach((r, i) => {
            const inputs = r.querySelectorAll('input');
            const col1 = isFinance ? `<td class="col-bil">${i+1}</td>` : '';
            target.innerHTML += `<tr>${col1}<td>${inputs[0].value}</td><td>${isFinance ? 'RM ' : ''}${inputs[1].value}</td></tr>`;
        });
    };

    fillTable('inputs-tentatif', 'v-tentatif');
    fillTable('inputs-ajk', 'v-ajk');
    fillTable('inputs-sumber', 'v-sumber', true);
    fillTable('inputs-belanja', 'v-belanja', true);
}

function exportJSON() {
    const getRows = (id) => Array.from(document.querySelectorAll(`#${id} .input-row`)).map(r => Array.from(r.querySelectorAll('input')).map(i => i.value));
    const data = {
        main: {
            tajuk: document.getElementById('in-tajuk').value,
            tarikh: document.getElementById('in-tarikh').value,
            masa: document.getElementById('in-masa').value,
            tempat: document.getElementById('in-tempat').value,
            pend: document.getElementById('in-pend').value,
            obj: document.getElementById('in-obj').value
        },
        sig: [
            document.getElementById('s1-n').value, document.getElementById('s1-j').value,
            document.getElementById('s2-n').value, document.getElementById('s2-j').value,
            document.getElementById('s3-n').value, document.getElementById('s3-j').value
        ],
        tentatif: getRows('inputs-tentatif'),
        ajk: getRows('inputs-ajk'),
        sumber: getRows('inputs-sumber'),
        belanja: getRows('inputs-belanja')
    };
    const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Projek_'+data.main.tajuk+'.json'; a.click();
}

function importJSON(e) {
    const reader = new FileReader();
    reader.onload = (ev) => {
        const d = JSON.parse(ev.target.result);
        Object.keys(d.main).forEach(k => document.getElementById('in-'+k).value = d.main[k]);
        const sigFields = ['s1-n','s1-j','s2-n','s2-j','s3-n','s3-j'];
        sigFields.forEach((f, i) => document.getElementById(f).value = d.sig[i]);
        
        const clearAndFill = (id, data, type) => {
            document.getElementById(id).innerHTML = '';
            data.forEach(row => tambah(type, row[0], row[1]));
        };
        clearAndFill('inputs-tentatif', d.tentatif, 'tentatif');
        clearAndFill('inputs-ajk', d.ajk, 'ajk');
        clearAndFill('inputs-sumber', d.sumber, 'sumber');
        clearAndFill('inputs-belanja', d.belanja, 'belanja');
        kemaskini();
    };
    reader.readAsText(e.target.files[0]);
}

window.onload = () => { tambah('tentatif'); tambah('ajk'); tambah('sumber'); tambah('belanja'); };
</script>
</body>
</html>
